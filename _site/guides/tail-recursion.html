<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>Tail Recursion</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Tammy's 61A resources.">
<link href="/cs61a-resources/css/bootstrap.min.css" rel="stylesheet">
<link href="/cs61a-resources/css/hc.css" rel="stylesheet">
<link href="/cs61a-resources/css/slidin.css" rel="stylesheet">
<link href="/cs61a-resources/css/pygments/tango.css" rel="stylesheet">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif] d-->

  </head>
  <body>
    <div class="nav-toggle"><i class="fa fa-bars fa-2x"></i> Herring Cove </div>
    <div id = "wrapper">
      <div class="navbar navbar-default" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <p class="navbar-brand">CS 61A Resources</p>
    </div>
    <div class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="cat3-toggle"><h5 class="toggle">Discussion Material</h5></li>
        <div class="cat3">
          
            <li> 
              <a href="/cs61a-resources/discussion/disc10.html"> Discussion 10 </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/discussion/disc09.html"> Discussion 9 </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/discussion/disc08.html"> Discussion 8 </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/discussion/disc07.html"> Discussion 7 </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/discussion/disc06.html"> Discussion 6 </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/discussion/disc05.html"> Discussion 5 </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/discussion/disc04.html"> Discussion 4 </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/discussion/disc03.html"> Discussion 3 </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/discussion/disc02.html"> Discussion 2 </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/discussion/disc01.html"> Discussion 1 </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/discussion/disc00.html"> Discussion 0 </a>
            </li>
          
        </div>

        <li class="cat1-toggle"><h5 class="toggle">Guides</h5></li>
        <div class="cat1">
          
            <li> 
              <a href="/guides/mutability.html"> Mutability and Nonlocal </a>
            </li>
          
            <li> 
              <a href="/guides/tail-recursion.html"> Tail Recursion </a>
            </li>
          
            <li> 
              <a href="/guides/scheme.html"> Scheme </a>
            </li>
          
            <li> 
              <a href="/guides/recursion.html"> Recursion </a>
            </li>
          
            <li> 
              <a href="/guides/oop.html"> Object Oriented Programming </a>
            </li>
          
            <li> 
              <a href="/guides/env-diag.html"> Environment Diagrams </a>
            </li>
          
        </div>

        <li class="cat2-toggle"><h5 class="toggle">Practice Problems</h5></li>
        <div class="cat2">
          
            <li> 
              <a href="/practice-problems/scheme.html"> Scheme </a>
            </li>
          
            <li> 
              <a href="/practice-problems/mt2.html"> Midterm 2 </a>
            </li>
          
            <li> 
              <a href="/practice-problems/mt1.html"> Midterm 1 </a>
            </li>
          
            <li> 
              <a href="/practice-problems/iter.html"> Iterables </a>
            </li>
          
            <li> 
              <a href="/practice-problems/final.html"> Final </a>
            </li>
          
        </div>

        <li class="cat4-toggle"><h5 class="toggle">Other</h5></li>
        <div class="cat4">
          
            <li> 
              <a href="/cs61a-resources/other/interpreters-review.html"> Fall 2016 Interpreters Final Review </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/other/trees.html"> Summer 2016 Trees Guest Lecture </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/other/sp16-mt1.html"> Spring 2016 MT1 Walkthrough </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/other/mt1-review.html"> Midterm 1 Review Slides </a>
            </li>
          
            <li> 
              <a href="/cs61a-resources/other/exams.html"> Course Advice </a>
            </li>
          
        </div>
        <li><a href="/cs61a-resources/about.html"><h5 class="toggle">About</h5></a></li>
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>

<!-- Sidebar -->
<div id="sidebar-wrapper">
  <ul class="sidebar-nav">
    <li class="sidebar-brand"><a href="/cs61a-resources/"><h1 class="brand">CS 61A</h1></a></li>
    <!-- todo: find a better way to hide on posts -->
    
    <hr />
        <li class="cat3-toggle"><h4 class="toggle">Discussion Material</h4></li>
    <div class="cat3">
      
        <li> 
          <a href="/cs61a-resources/discussion/disc10.html"> Discussion 10 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/discussion/disc09.html"> Discussion 9 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/discussion/disc08.html"> Discussion 8 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/discussion/disc07.html"> Discussion 7 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/discussion/disc06.html"> Discussion 6 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/discussion/disc05.html"> Discussion 5 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/discussion/disc04.html"> Discussion 4 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/discussion/disc03.html"> Discussion 3 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/discussion/disc02.html"> Discussion 2 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/discussion/disc01.html"> Discussion 1 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/discussion/disc00.html"> Discussion 0 </a>
        </li>
      
    </div>
    <li class="cat1-toggle"><h4 class="toggle">Guides</h4></li>
    <div class="cat1">
      
        <li> 
          <a href="/cs61a-resources/guides/mutability.html"> Mutability and Nonlocal </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/guides/tail-recursion.html"> Tail Recursion </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/guides/scheme.html"> Scheme </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/guides/recursion.html"> Recursion </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/guides/oop.html"> Object Oriented Programming </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/guides/env-diag.html"> Environment Diagrams </a>
        </li>
      
    </div>
    <li class="cat2-toggle"><h4 class="toggle">Practice Problems</h4></li>
    <div class="cat2">
      
        <li> 
          <a href="/cs61a-resources/practice-problems/scheme.html"> Scheme </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/practice-problems/mt2.html"> Midterm 2 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/practice-problems/mt1.html"> Midterm 1 </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/practice-problems/iter.html"> Iterables </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/practice-problems/final.html"> Final </a>
        </li>
      
    </div>

    <li class="cat4-toggle"><h4 class="toggle">Other</h4></li>
    <div class="cat4">
      
        <li> 
          <a href="/cs61a-resources/other/interpreters-review.html"> Fall 2016 Interpreters Final Review </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/other/trees.html"> Summer 2016 Trees Guest Lecture </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/other/sp16-mt1.html"> Spring 2016 MT1 Walkthrough </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/other/mt1-review.html"> Midterm 1 Review Slides </a>
        </li>
      
        <li> 
          <a href="/cs61a-resources/other/exams.html"> Course Advice </a>
        </li>
      
    </div>
    <li><a href="/cs61a-resources/about.html"><h4>About</h4></a></li>
    <hr />
  </ul>
</div>

      <div class="container">
        <div id="article">
  <div class="article-title">Tail Recursion</div>
  <hr/>
  <div class="post">
    <p><strong>This page is under construction!</strong></p>

<hr />

<p>Scheme supports optimized tail recursion, meaning that if a function is called in <strong>tail context</strong>, Scheme will close the frame that called it and simply return the value that the tail call returns. Scheme thus allows for an unbounded number of tail calls, unlike Python, which will raise a <code>RuntimeError: 'maximum recursion depth exceeded'</code> because all the frames stay open.</p>

<p>To write a tail-call optimized function in Scheme, you must make all recursive calls in a tail context.</p>

<hr />

<h4 id="tail-context">Tail Context</h4>
<p>An expression is in a <strong>tail context</strong> if it is the last expression to be evaluated in the frame. Thus, a call expression is a <strong>tail call</strong> if it is one of the following:</p>

<ul>
  <li>the last sub-expression in the body of a tail-context <code>lambda</code> expression</li>
  <li>the second or third sub-expression in a tail-context <code>if</code> expression</li>
  <li>a non-predicate sub-expression in a tail-context <code>cond</code> expression</li>
  <li>the last sub-expression in a tail-context <code>and</code> or <code>or</code> expression</li>
  <li>the last sub-expression in a tail-context <code>begin</code> expression</li>
</ul>

<p>A function is then <strong>tail recursive</strong> if the recursive call(s) is a/are tail call(s).</p>

<h4 id="test-your-understanding">Test your understanding</h4>

<p><strong>Answer these questions for the following functions.</strong></p>

<ol>
  <li>What are the tail calls?</li>
  <li>Are the recursive calls tail calls?</li>
  <li>Is the function tail recursive?</li>
</ol>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">foo</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> 
        <span class="p">(</span><span class="nf">foo</span> <span class="p">(</span><span class="nb">- </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span> 
        <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)))</span></code></pre></figure>

<blockquote class="solution">
<ol>
  <li> <code>(foo (- x y))</code> is a tail call because it is the second subexpression in the <code>if</code> expresssion. <code>(+ x y)</code> is also a tail call because it is the third subexpression in the <code>if</code> expression.  </li>
  <li> Yes, the recursive call <code>(foo (- x y))</code> is a tail call.  </li>
  <li> Yes, because the recursive call is a tail call.</li>
</ol>
</blockquote>

<p><a class="btn btn-default solution-toggle">TOGGLE SOLUTION</a></p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">bar</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">bar</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">x</span>
        <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">bar</span> <span class="mi">9</span><span class="p">)</span> <span class="mi">1</span><span class="p">))</span></code></pre></figure>

<blockquote class="solution-2">
<ol>
<li><code>(- (bar 9) 1)</code> is a tail call because it is the third subexpression in the <code>if</code> expresssion.</li>
<li>The recursive calls <code>(bar x)</code> is not a tail call because it is the first subexpression in the <code>if</code> expression. The recursive call <code>(bar 9)</code> is also not a tail call because it is an argument of the tail call.</li>
<li>No, because the recursive calls are not tail calls.</li>
</ol>
</blockquote>

<p><a class="btn btn-default solution-toggle-2">TOGGLE SOLUTION</a></p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">baz</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">bar</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="k">begin </span><span class="p">(</span><span class="nf">foo</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">baz</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">x</span><span class="p">))))</span>
        <span class="p">((</span><span class="nf">baz</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">baz</span> <span class="mi">2</span><span class="p">))</span>
        <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">foo</span> <span class="nv">x</span> <span class="mi">1</span><span class="p">)</span> <span class="no">#t</span> <span class="p">(</span><span class="nf">bar</span> <span class="mi">4</span><span class="p">))))</span>
      <span class="p">)</span></code></pre></figure>

<blockquote class="solution-3">
<ol>
<li><code>(baz (+ x x))</code> is a tail call because it is the last subexpression in a tail-context <code>begin</code> expression. <code>(baz 2)</code> is a tail call because it is a non-predicate subexpression in the <code>cond</code> expression. <code>(bar 4)</code> is a tail call because it is the last subexpression in a tail-context <code>and</code> expression.</li>  
<li>Two of the tail calls mentioned above are recursive calls. The recursive call <code>(baz 1)</code> is not a tail call because it is a predicate subexpression in the <code>cond</code> expression.  </li>
<li>No, even though there are two recursive tail calls, there is a recursive call that is not a tail call.</li>
</ol>
</blockquote>
<p><a class="btn btn-default solution-toggle-3">TOGGLE SOLUTION</a></p>

<p><a name="keep" class="anchor"></a></p>

<h2 id="writing-tail-recursive-functions">Writing tail recursive functions</h2>
<p>Often, you may find it easier to first come up with an iterative solution in Python and convert it into a tail recursive Scheme solution. For example, let’s try to write a function that makes a list out of the first <code>n</code> elements of a given <code>lst</code> (assume <code>lst</code> is at least length <code>n</code>). If you want to try this out on your own first, click <a href="/cs61a-resources/practice-problems/final.html#tail">here</a>.</p>

<p>To do this, we would start with an empty <code>result</code> list and keep a counter, adding elements to <code>result</code> from <code>lst</code> until our counter hits <code>n</code>. Here’s the iterative Python version for a linked list:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">keep_first_n</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Link</span><span class="o">.</span><span class="n">empty</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">rest</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span></code></pre></figure>

<p>Since there are no <code>while</code> loops in Scheme, we can imitate this using a helper function! A helper function will keep track of variables that change in its parameters! In this case, the counter <code>i</code>, our <code>result</code> list, and the link pointer change, so our helper function will take in three parameters <code>i</code>, <code>result</code>, and <code>lst</code>.</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">keep-first-n</span> <span class="nv">lst</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">keep-helper</span> <span class="nv">i</span> <span class="nv">result</span> <span class="nv">lst</span><span class="p">)</span>

    <span class="p">))</span></code></pre></figure>

<p>To simulate the <code>while</code> condition, we use a base case to return our result when we’re done. We want to stop adding to <code>result</code> and return it when <code>i</code> is equal to <code>n</code>. Whatever happens in the while loop will go in the “else” case.</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">keep-first-n</span> <span class="nv">lst</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">keep-helper</span> <span class="nv">i</span> <span class="nv">result</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">i</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">result</span><span class="p">)</span>
    <span class="p">))</span></code></pre></figure>

<p>So far, so good. Now we need to take care of what goes on in the <code>while</code> loop, which is updating <code>result</code>, <code>lst</code>, and <code>i</code>. Using recursion, we simply update our “variables” by passing their new values as arguments to a recursive call.</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">keep-first-n</span> <span class="nv">lst</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">keep-helper</span> <span class="nv">i</span> <span class="nv">result</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">i</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">result</span>
        <span class="p">(</span><span class="nf">keep-helper</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">append </span><span class="nv">result</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">car </span><span class="nv">lst</span><span class="p">)))</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">lst</span><span class="p">)))</span>
    <span class="p">))</span></code></pre></figure>

<p>Almost done! All that’s left to do now is initialize our “variables”. To do this, call our helper function in the body of the original function with the initial values as arguments.</p>

<figure class="highlight"><pre><code class="language-scheme" data-lang="scheme"><span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">keep-first-n</span> <span class="nv">lst</span> <span class="nv">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">helper</span> <span class="nv">i</span> <span class="nv">result</span> <span class="nv">lst</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">i</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">result</span>
        <span class="p">(</span><span class="nf">helper</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">i</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">append </span><span class="nv">result</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">car </span><span class="nv">lst</span><span class="p">)))</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">lst</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">(</span><span class="nf">helper</span> <span class="mi">0</span> <span class="o">&#39;</span><span class="p">()</span> <span class="nv">lst</span><span class="p">))</span></code></pre></figure>

<p>This function is now a tail-recursive version of the iterative solution!</p>

  </div>
</div>

      <div class="container">
  <footer>
    <p class="text-muted credit">
      &copy; 2016 <a href="http://tmmydngyn.com/">Tammy Nguyen</a> &middot;
      <a href="https://github.com/arnp/herring-cove"> Herring Cove for Jekyll </a>
    </p>
  </footer>
</div>

      </div>
    </div>
    <!-- Bootstrap core JavaScript-->
<script src="/cs61a-resources/js/jquery-1.10.2.min.js"></script>
<script src="/cs61a-resources/js/bootstrap.min.js"></script>
<script src="/cs61a-resources/js/hc.js"></script>
<script src="/cs61a-resources/js/slidin.js"></script>

  </body>
</html>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-70344118-2', 'auto');
  ga('send', 'pageview');

</script>